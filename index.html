<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Playables Library</title>
  <style>
    body{font-family:Arial, sans-serif; background:#0f1115; color:#e8e8e8; margin:0; padding:28px;}
    h1{margin:0 0 14px 0; font-size:22px;}
    #meta{opacity:.8; font-size:13px; margin-bottom:18px;}
    a{color:#66d9ff; text-decoration:none;}
    a:hover{text-decoration:underline;}
    .card{background:#151a22; border:1px solid #232a36; border-radius:10px; padding:14px; margin:12px 0;}
    details{margin-left:10px;}
    summary{cursor:pointer; user-select:none; padding:6px 6px; border-radius:8px;}
    summary:hover{background:#1c2230;}
    .folder{font-weight:600;}
    .file{display:flex; align-items:center; gap:10px; padding:6px 10px; border-radius:8px; margin:4px 0 4px 18px;}
    .file:hover{background:#1c2230;}
    .tag{font-size:11px; opacity:.75; border:1px solid #2a3345; padding:2px 6px; border-radius:999px;}
    .muted{opacity:.75;}
    .controls{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 0;}
    button{background:#1c2230; color:#e8e8e8; border:1px solid #2a3345; padding:8px 10px; border-radius:8px; cursor:pointer;}
    button:hover{background:#242c3c;}
    input{background:#0f1115; color:#e8e8e8; border:1px solid #2a3345; padding:8px 10px; border-radius:8px; min-width:240px;}
    .error{color:#ffb4b4;}
  </style>
</head>
<body>
  <h1>ðŸŽ® Playables Library</h1>
  <div id="meta" class="muted">Loadingâ€¦</div>

  <div class="card">
    <div class="controls">
      <button id="expandAll">Expand all</button>
      <button id="collapseAll">Collapse all</button>
      <input id="search" placeholder="Search files/foldersâ€¦" />
    </div>
  </div>

  <div id="tree" class="card">Loading repository filesâ€¦</div>

<script>
(() => {
  const username = "yasertmood-png";
  const repo = "Playables";
  const branch = "main"; // change if needed

  // Which files to exclude
  const EXCLUDE = new Set(["README.md", "index.html"]);

  // Which file types to show as "playables"
  // Add more extensions if you want.
  const ALLOWED_EXT = [".html"];

  const metaEl = document.getElementById("meta");
  const treeEl = document.getElementById("tree");
  const searchEl = document.getElementById("search");

  const pagesBase = `https://${username}.github.io/${repo}/`;
  const apiTree = `https://api.github.com/repos/${username}/${repo}/git/trees/${branch}?recursive=1`;

  function isAllowedPlayable(path) {
    const lower = path.toLowerCase();
    return ALLOWED_EXT.some(ext => lower.endsWith(ext));
  }

  function buildNestedTree(paths) {
    // Tree node format:
    // { type:"dir", children: Map(name -> node) } or { type:"file", path }
    const root = { type: "dir", children: new Map() };

    for (const p of paths) {
      const parts = p.split("/").filter(Boolean);
      let cur = root;

      for (let i = 0; i < parts.length; i++) {
        const name = parts[i];
        const isLast = i === parts.length - 1;

        if (isLast) {
          cur.children.set(name, { type: "file", path: p });
        } else {
          if (!cur.children.has(name)) {
            cur.children.set(name, { type: "dir", children: new Map() });
          }
          cur = cur.children.get(name);
        }
      }
    }
    return root;
  }

  function sortChildren(map) {
    // Folders first, then files; alphabetical
    return [...map.entries()].sort((a, b) => {
      const A = a[1], B = b[1];
      if (A.type !== B.type) return A.type === "dir" ? -1 : 1;
      return a[0].localeCompare(b[0], undefined, { sensitivity: "base" });
    });
  }

  function renderNode(node, name = "", depth = 0) {
    if (node.type === "file") {
      const fileName = name;
      const url = pagesBase + node.path;

      const div = document.createElement("div");
      div.className = "file";
      div.dataset.path = node.path.toLowerCase();
      div.innerHTML = `
        <a href="${url}" target="_blank" rel="noopener">${fileName}</a>
        <span class="tag">${fileName.split(".").pop().toUpperCase()}</span>
        <span class="muted" style="font-size:12px;">${node.path}</span>
      `;
      return div;
    }

    // directory
    const details = document.createElement("details");
    details.dataset.folder = (name || "/").toLowerCase();

    // Top-level open by default? (optional)
    if (depth === 0) details.open = true;

    const summary = document.createElement("summary");
    summary.className = "folder";
    summary.textContent = name || `${repo}/`;

    details.appendChild(summary);

    const wrapper = document.createElement("div");
    wrapper.style.marginLeft = "10px";

    for (const [childName, childNode] of sortChildren(node.children)) {
      wrapper.appendChild(renderNode(childNode, childName, depth + 1));
    }

    details.appendChild(wrapper);
    return details;
  }

  function setAllDetails(open) {
    document.querySelectorAll("#tree details").forEach(d => d.open = open);
  }

  function applySearch(q) {
    q = q.trim().toLowerCase();
    const allFiles = [...document.querySelectorAll("#tree .file")];
    const allFolders = [...document.querySelectorAll("#tree details")];

    if (!q) {
      // reset
      allFiles.forEach(el => el.style.display = "");
      allFolders.forEach(el => el.style.display = "");
      return;
    }

    // Hide everything first
    allFiles.forEach(el => el.style.display = "none");
    allFolders.forEach(el => el.style.display = "none");

    // Show matching files and their parent folders
    for (const fileEl of allFiles) {
      const path = fileEl.dataset.path || "";
      if (path.includes(q)) {
        fileEl.style.display = "";

        // show parent folders + open them
        let parent = fileEl.parentElement;
        while (parent) {
          if (parent.tagName && parent.tagName.toLowerCase() === "details") {
            parent.style.display = "";
            parent.open = true;
          }
          parent = parent.parentElement;
        }
      }
    }

    // Also show folders that match query (even if no file matches)
    for (const folderEl of allFolders) {
      const folderKey = folderEl.dataset.folder || "";
      if (folderKey.includes(q)) {
        folderEl.style.display = "";
        folderEl.open = true;
        // show all descendants
        folderEl.querySelectorAll(".file").forEach(el => el.style.display = "");
        folderEl.querySelectorAll("details").forEach(el => { el.style.display = ""; el.open = true; });
      }
    }
  }

  async function main() {
    metaEl.textContent = `Repo: ${}/${repo} Â· Branch: ${branch}`;

    try {
      const res = await fetch(apiTree, {
        headers: { "Accept": "application/vnd.github+json" }
      });

      if (!res.ok) {
        throw new Error(`GitHub API error: ${res.status} ${res.statusText}`);
      }

      const data = await res.json();
      const items = Array.isArray(data.tree) ? data.tree : [];

      // Keep only "blob" files, exclude README/index, keep allowed ext
      const playablePaths = items
        .filter(x => x.type === "blob" && typeof x.path === "string")
        .map(x => x.path)
        .filter(p => !EXCLUDE.has(p.split("/").pop()))
        .filter(p => isAllowedPlayable(p));

      if (playablePaths.length === 0) {
        treeEl.innerHTML = `<div class="muted">No playables found. Upload .html files to the repo.</div>`;
        return;
      }

      // Build nested structure and render
      const nested = buildNestedTree(playablePaths);
      treeEl.innerHTML = "";
      treeEl.appendChild(renderNode(nested, "", 0));

      // Controls
      document.getElementById("expandAll").addEventListener("click", () => setAllDetails(true));
      document.getElementById("collapseAll").addEventListener("click", () => setAllDetails(false));

      searchEl.addEventListener("input", (e) => applySearch(e.target.value));

    } catch (err) {
      treeEl.innerHTML = `<div class="error">Failed to load files: ${err.message}</div>
                          <div class="muted" style="margin-top:8px;">
                            If your repo is private, the GitHub API wonâ€™t allow this without authentication.
                            Make sure the repo is public.
                          </div>`;
    }
  }

  main();
})();
</script>
</body>
</html>
