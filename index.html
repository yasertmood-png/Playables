<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Playables</title>

<style>
body{
  font-family:Arial, sans-serif;
  background:#0f1115;
  color:#e8e8e8;
  margin:0;
  padding:28px;
}
h1{margin-bottom:10px;}

.card{
  background:#151a22;
  border:1px solid #232a36;
  border-radius:10px;
  padding:14px;
  margin:12px 0;
}

details{margin-left:10px;}
summary{
  cursor:pointer;
  padding:6px;
  border-radius:8px;
  font-weight:bold;
}
summary:hover{background:#1c2230;}

.controls{display:flex; gap:10px; flex-wrap:wrap;}
button{
  background:#1c2230;
  color:#fff;
  border:1px solid #2a3345;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
}
button:hover{background:#242c3c;}

input{
  background:#0f1115;
  color:#fff;
  border:1px solid #2a3345;
  padding:8px 12px;
  border-radius:8px;
}

.file{margin:6px 0 6px 18px;}

.file button{
  background:#2ecc71;
  border:none;
  padding:10px 16px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
.file button:hover{background:#28b463;}
</style>
</head>

<body>

<h1>ðŸŽ® Playables</h1>

<div class="card">
  <div class="controls">
    <button id="expandAll">Expand all</button>
    <button id="collapseAll">Collapse all</button>
    <input id="search" placeholder="Search foldersâ€¦" />
  </div>
</div>

<div id="tree" class="card">Loading repository filesâ€¦</div>

<script>
const EXCLUDE = ["README.md","index.html"];
const ALLOWED_EXT = [".html"];

function inferRepo(){
  const host = location.hostname.split(".github.io")[0];
  const repo = location.pathname.split("/")[1];
  return {owner:host, repo};
}

function buildTree(paths){
  const root={children:{}};
  paths.forEach(p=>{
    const parts=p.split("/");
    let cur=root;
    parts.forEach((part,i)=>{
      if(i===parts.length-1){
        cur.children[part]={file:true,path:p};
      }else{
        cur.children[part]=cur.children[part]||{children:{}};
        cur=cur.children[part];
      }
    });
  });
  return root;
}

function renderNode(node,name,base){
  if(node.file){
    const div=document.createElement("div");
    div.className="file";
    const url=base+node.path;
    div.innerHTML=`<button onclick="window.open('${url}','_blank')">â–¶ Run</button>`;
    return div;
  }

  const details=document.createElement("details");
  if(!name) details.open=true;

  const summary=document.createElement("summary");
  summary.textContent=name || "All Playables";
  details.appendChild(summary);

  Object.entries(node.children).sort().forEach(([n,child])=>{
    details.appendChild(renderNode(child,n,base));
  });

  return details;
}

async function load(){
  const {owner,repo}=inferRepo();
  const apiRepo=`https://api.github.com/repos/${owner}/${repo}`;
  const repoInfo=await fetch(apiRepo).then(r=>r.json());
  const branch=repoInfo.default_branch;

  const apiTree=`https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;
  const data=await fetch(apiTree).then(r=>r.json());

  const files=data.tree
    .filter(x=>x.type==="blob")
    .map(x=>x.path)
    .filter(p=>!EXCLUDE.includes(p.split("/").pop()))
    .filter(p=>ALLOWED_EXT.some(ext=>p.toLowerCase().endsWith(ext)));

  const base=`https://${owner}.github.io/${repo}/`;
  const tree=buildTree(files);

  const container=document.getElementById("tree");
  container.innerHTML="";
  container.appendChild(renderNode(tree,"",base));
}

document.getElementById("expandAll").onclick=()=>document.querySelectorAll("details").forEach(d=>d.open=true);
document.getElementById("collapseAll").onclick=()=>document.querySelectorAll("details").forEach(d=>d.open=false);

document.getElementById("search").addEventListener("input",e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll("details").forEach(d=>{
    d.style.display=d.innerText.toLowerCase().includes(q)?"":"none";
  });
});

load();
</script>

</body>
</html>
